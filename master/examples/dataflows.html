

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>DataFlow HTTP Deployment &mdash; DFFML ca3e51f7b documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/tabs.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script src="../_static/tabs.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="MNIST Handwriten Digits" href="mnist.html" />
    <link rel="prev" title="Meta Static Analysis" href="shouldi.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> DFFML
          

          
          </a>

          
            
            
              <div class="version">
                ca3e51f7b
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/index.html">Concepts</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Usage</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../quickstart/model.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="notebooks/index.html">Notebooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="integration.html">Automating Classification</a></li>
<li class="toctree-l2"><a class="reference internal" href="shouldi.html">Meta Static Analysis</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">DataFlow HTTP Deployment</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#config-files">Config Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#multicomms">MultiComms</a></li>
<li class="toctree-l3"><a class="reference internal" href="#http-channel-config">HTTP Channel Config</a></li>
<li class="toctree-l3"><a class="reference internal" href="#serving-the-dataflow">Serving the DataFlow</a></li>
<li class="toctree-l3"><a class="reference internal" href="#combining-operations">Combining Operations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#redeploying">Redeploying</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="mnist.html">MNIST Handwriten Digits</a></li>
<li class="toctree-l2"><a class="reference internal" href="flower17/flower17.html">Flower17 Species Classification</a></li>
<li class="toctree-l2"><a class="reference internal" href="or_covid_data_by_county.html">COVID Forecasting</a></li>
<li class="toctree-l2"><a class="reference internal" href="webhook/index.html">Continuous Deployment of DataFlows</a></li>
<li class="toctree-l2"><a class="reference internal" href="icecream_sales.html">Ice Cream Sales</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../plugins/index.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli.html">Command Line</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plugins/service/http/index.html">HTTP API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/plugins.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/noasync.html">Noasync</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/base.html">Base</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/record.html">Record</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/log.html">Log</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/high_level.html">High_Level</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/version.html">Version</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/source/index.html">Source</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/operation/index.html">Operation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/feature/index.html">Feature</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/cli/index.html">Cli</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/secret/index.html">Secret</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/df/index.html">Df</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/db/index.html">Db</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/service/index.html">Service</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/configloader/index.html">Configloader</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/model/index.html">Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/util/index.html">Util</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/port/index.html">Port</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../arch/index.html">Architecture</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Subprojects</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../shouldi.html">shouldi</a></li>
<li class="toctree-l1"><a class="reference internal" href="../swportal.html">Software Portal</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Community</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/intel/dffml">GitHub</a></li>
<li class="toctree-l1"><a class="reference external" href="https://intel.github.io/dffml/master/">Master Branch Docs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../publications.html">Publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contact.html">Contact Us</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../news/index.html">News</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">DFFML</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Examples</a> &raquo;</li>
        
      <li>DataFlow HTTP Deployment</li>
    
    


      <li class="wy-breadcrumbs-aside">
        
          
            
              <a href="https://github.com/intel/dffml/blob/master/docs/examples/dataflows.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    


  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="dataflow-http-deployment">
<h1>DataFlow HTTP Deployment<a class="headerlink" href="#dataflow-http-deployment" title="Permalink to this headline">¶</a></h1>
<p>In the <a class="reference internal" href="shouldi.html"><span class="doc">Meta Static Analysis</span></a> we created a command line meta static
analysis tool, <code class="docutils literal notranslate"><span class="pre">shouldi</span></code>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>shouldi install dffml insecure-package
<span class="go">dffml is okay to install</span>
<span class="go">Do not install insecure-package!</span>
<span class="go">    safety_check.outputs.result: 1</span>
<span class="go">    run_bandit.outputs.result: {&#39;CONFIDENCE.HIGH&#39;: 0.0, &#39;CONFIDENCE.LOW&#39;: 0.0, &#39;CONFIDENCE.MEDIUM&#39;: 0.0, &#39;CONFIDENCE.UNDEFINED&#39;: 0.0, &#39;SEVERITY.HIGH&#39;: 0.0, &#39;SEVERITY.LOW&#39;: 0.0, &#39;SEVERITY.MEDIUM&#39;: 0.0, &#39;SEVERITY.UNDEFINED&#39;: 0.0, &#39;loc&#39;: 100, &#39;nosec&#39;: 0, &#39;CONFIDENCE.HIGH_AND_SEVERITY.LOW&#39;: 0, &#39;CONFIDENCE.HIGH_AND_SEVERITY.MEDIUM&#39;: 0, &#39;CONFIDENCE.HIGH_AND_SEVERITY.HIGH&#39;: 0}</span>
</pre></div>
</div>
<p>In the <a class="reference internal" href="shouldi.html#examples-shouldi-registering-opreations"><span class="std std-ref">Registering Operations</span></a> section of the
operations tutorial, we registered our operations with Python’s <code class="docutils literal notranslate"><span class="pre">entrypoint</span></code>
system. This allows other Python packages and DFFML plugins to access them
without the need to hardcode in <code class="docutils literal notranslate"><span class="pre">import</span></code> statements.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>curl -s <span class="se">\</span>
<span class="go">  --header &quot;Content-Type: application/json&quot; \</span>
<span class="go">  --request POST \</span>
<span class="go">  --data &#39;{&quot;insecure-package&quot;: [{&quot;value&quot;:&quot;insecure-package&quot;,&quot;definition&quot;:&quot;safety_check.inputs.package&quot;}]}&#39; \</span>
<span class="go">  http://localhost:8080/shouldi | python3 -m json.tool</span>
<span class="go">{</span>
<span class="go">    &quot;insecure-package&quot;: {</span>
<span class="go">        &quot;safety_check.outputs.result&quot;: 1,</span>
<span class="go">        &quot;run_bandit.outputs.result&quot;: {</span>
<span class="go">            &quot;CONFIDENCE.HIGH&quot;: 0.0,</span>
<span class="go">            &quot;CONFIDENCE.LOW&quot;: 0.0,</span>
<span class="go">            &quot;CONFIDENCE.MEDIUM&quot;: 0.0,</span>
<span class="go">            &quot;CONFIDENCE.UNDEFINED&quot;: 0.0,</span>
<span class="go">            &quot;SEVERITY.HIGH&quot;: 0.0,</span>
<span class="go">            &quot;SEVERITY.LOW&quot;: 0.0,</span>
<span class="go">            &quot;SEVERITY.MEDIUM&quot;: 0.0,</span>
<span class="go">            &quot;SEVERITY.UNDEFINED&quot;: 0.0,</span>
<span class="go">            &quot;loc&quot;: 100,</span>
<span class="go">            &quot;nosec&quot;: 0,</span>
<span class="go">            &quot;CONFIDENCE.HIGH_AND_SEVERITY.LOW&quot;: 0,</span>
<span class="go">            &quot;CONFIDENCE.HIGH_AND_SEVERITY.MEDIUM&quot;: 0,</span>
<span class="go">            &quot;CONFIDENCE.HIGH_AND_SEVERITY.HIGH&quot;: 0</span>
<span class="go">        }</span>
<span class="go">    }</span>
<span class="go">}</span>
</pre></div>
</div>
<div class="section" id="config-files">
<h2>Config Files<a class="headerlink" href="#config-files" title="Permalink to this headline">¶</a></h2>
<p>As we saw before, DataFlows can be serialized to config files. JSON
representations of DataFlows are not fun to hand edit. YAML looks a lot cleaner.</p>
<p>We’re going to install the <code class="docutils literal notranslate"><span class="pre">dffml-config-yaml</span></code> package so that we don’t have
to look at JSON.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python -m pip install dffml-config-yaml
</pre></div>
</div>
<p>We’ll be working from the top level directory of the <code class="docutils literal notranslate"><span class="pre">shouldi</span></code> package we
created in the <a class="reference internal" href="shouldi.html"><span class="doc">Meta Static Analysis</span></a> example.</p>
<p>The source for that package is also available under the <code class="docutils literal notranslate"><span class="pre">examples/shouldi</span></code>
directory of the DFFML source code.</p>
<p>If you’d like to skip <a class="reference internal" href="shouldi.html"><span class="doc">Meta Static Analysis</span></a> example, clone the dffml repo
Then change directory into the <code class="docutils literal notranslate"><span class="pre">shouldi</span></code> source code you would have written in
the <a class="reference internal" href="shouldi.html"><span class="doc">Meta Static Analysis</span></a> example.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>git clone --depth<span class="o">=</span><span class="m">1</span> https://github.com/intel/dffml dffml
<span class="gp">$ </span><span class="nb">cd</span> dffml
<span class="gp">$ </span><span class="nb">cd</span> examples/shouldi
<span class="gp">$ </span>python -m pip install -e .
</pre></div>
</div>
<p>Config files are named after the dataflow they are associated with. In the
<a class="reference internal" href="shouldi.html#examples-shouldi-visualizing-the-dataflow"><span class="std std-ref">Visualizing the DataFlow</span></a> section of the
<a class="reference internal" href="shouldi.html"><span class="doc">Meta Static Analysis</span></a>, we serialized the <code class="docutils literal notranslate"><span class="pre">shouldi</span></code> dataflow to the
<code class="docutils literal notranslate"><span class="pre">shouldi/deploy/df</span></code> directory.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">df</span></code> directory is contains the main dataflows to be deployed.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>tree shouldi/deploy/
<span class="go">shouldi/deploy/</span>
<span class="go">└── df</span>
<span class="go">    └── shouldi.json</span>

<span class="go">1 directory, 1 file</span>
</pre></div>
</div>
</div>
<div class="section" id="multicomms">
<h2>MultiComms<a class="headerlink" href="#multicomms" title="Permalink to this headline">¶</a></h2>
<p>Another concept in DFFML is the <code class="docutils literal notranslate"><span class="pre">MultiComm</span></code>, they are contain multiple
channels of communications. <code class="docutils literal notranslate"><span class="pre">MultiComm</span></code>’s will typically be protocol based.
An IRC or Slack <code class="docutils literal notranslate"><span class="pre">MultiComm</span></code> channel of communication might be a chat room, or
when a particular word immediately follows the bots name.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">myuser</span>    <span class="o">|</span> <span class="n">mybot</span><span class="p">:</span> <span class="n">shouldi</span> <span class="n">install</span> <span class="o">...</span>
</pre></div>
</div>
<p>The HTTP server was the first <code class="docutils literal notranslate"><span class="pre">MultiComm</span></code> written for DFFML. It’s channels of
communication are URL paths (Example: <code class="docutils literal notranslate"><span class="pre">/some/url/path</span></code>).</p>
<p>Let’s install the HTTP API service.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python -m pip install dffml-service-http
</pre></div>
</div>
</div>
<div class="section" id="http-channel-config">
<h2>HTTP Channel Config<a class="headerlink" href="#http-channel-config" title="Permalink to this headline">¶</a></h2>
<p>To deploy our <code class="docutils literal notranslate"><span class="pre">shouldi</span></code> dataflow via the HTTP API, we need to register a
communication channel, which is the association of a URL path to the dataflow.</p>
<p>We create a config file for the <code class="docutils literal notranslate"><span class="pre">MultiComm</span></code> we’ll be using. <code class="docutils literal notranslate"><span class="pre">MultiComm</span></code>
config files go under the <code class="docutils literal notranslate"><span class="pre">mc</span></code> directory of the directory being
used to deploy. Then config file itself then goes under the name of the
<code class="docutils literal notranslate"><span class="pre">MultiComm</span></code> its associated with, <code class="docutils literal notranslate"><span class="pre">http</span></code> in this instance.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>mkdir -p shouldi/deploy/mc/http
</pre></div>
</div>
<p>The file is populated with the URL path that should trigger the dataflow, how to
present the output data, and if the dataflow should return when all outputs
exist, or if it should continue waiting for more inputs (<code class="docutils literal notranslate"><span class="pre">asynchronous</span></code>, used
for websockets / http2).</p>
<p><strong>shouldi/deploy/mc/http/shouldi.yaml</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">path</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/shouldi</span>
<span class="nt">output_mode</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">json</span>
<span class="nt">asynchronous</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
</pre></div>
</div>
</div>
<div class="section" id="serving-the-dataflow">
<h2>Serving the DataFlow<a class="headerlink" href="#serving-the-dataflow" title="Permalink to this headline">¶</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The <code class="docutils literal notranslate"><span class="pre">-insecure</span></code> flag is only being used here to speed up this
tutorial. See documentation on HTTP API
<a class="reference internal" href="../plugins/service/http/security.html"><span class="doc">Security</span></a> for more information.</p>
</div>
<p>We now start the http server and tell it that the <code class="docutils literal notranslate"><span class="pre">MultiComm</span></code> configuration
directory can be found in <code class="docutils literal notranslate"><span class="pre">shouldi/deploy</span></code>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>dffml service http server -port <span class="m">8080</span> -insecure -mc-config shouldi/deploy
</pre></div>
</div>
<p>In another terminal, you can send a <code class="docutils literal notranslate"><span class="pre">POST</span></code> request containing the <code class="docutils literal notranslate"><span class="pre">Input</span></code>
items that you want evaluated.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>curl -sf <span class="se">\</span>
<span class="go">  --header &quot;Content-Type: application/json&quot; \</span>
<span class="go">  --request POST \</span>
<span class="go">  --data &#39;{&quot;insecure-package&quot;: [{&quot;value&quot;:&quot;insecure-package&quot;,&quot;definition&quot;:&quot;safety_check.inputs.package&quot;}]}&#39; \</span>
<span class="go">  http://localhost:8080/shouldi | python -m json.tool</span>
<span class="go">{</span>
<span class="go">    &quot;insecure-package&quot;: {</span>
<span class="go">        &quot;safety_check.outputs.result&quot;: 1,</span>
<span class="go">        &quot;run_bandit.outputs.result&quot;: {</span>
<span class="go">            &quot;CONFIDENCE.HIGH&quot;: 0.0,</span>
<span class="go">            &quot;CONFIDENCE.LOW&quot;: 0.0,</span>
<span class="go">            &quot;CONFIDENCE.MEDIUM&quot;: 0.0,</span>
<span class="go">            &quot;CONFIDENCE.UNDEFINED&quot;: 0.0,</span>
<span class="go">            &quot;SEVERITY.HIGH&quot;: 0.0,</span>
<span class="go">            &quot;SEVERITY.LOW&quot;: 0.0,</span>
<span class="go">            &quot;SEVERITY.MEDIUM&quot;: 0.0,</span>
<span class="go">            &quot;SEVERITY.UNDEFINED&quot;: 0.0,</span>
<span class="go">            &quot;loc&quot;: 100,</span>
<span class="go">            &quot;nosec&quot;: 0,</span>
<span class="go">            &quot;CONFIDENCE.HIGH_AND_SEVERITY.LOW&quot;: 0,</span>
<span class="go">            &quot;CONFIDENCE.HIGH_AND_SEVERITY.MEDIUM&quot;: 0,</span>
<span class="go">            &quot;CONFIDENCE.HIGH_AND_SEVERITY.HIGH&quot;: 0</span>
<span class="go">        }</span>
<span class="go">    }</span>
<span class="go">}</span>
</pre></div>
</div>
</div>
<div class="section" id="combining-operations">
<h2>Combining Operations<a class="headerlink" href="#combining-operations" title="Permalink to this headline">¶</a></h2>
<p>If you’ve gone through the <a class="reference internal" href="integration.html"><span class="doc">Automating Classification</span></a> example, you’ve seen the
Git and source code analysis related operations (a list of all available
operations can be found on the <a class="reference internal" href="../plugins/dffml_operation.html"><span class="doc">Operations</span></a> plugins page).</p>
<p>We’ll be using those operations, so we need to install them</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python -m pip install dffml-feature-git
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">lines_of_code_to_comments</span></code> operation will give use the ratio of the
number of lines of comments to the number of lines of code.</p>
<p>You need to install <a class="reference external" href="https://github.com/XAMPPRocky/tokei">tokei</a> before you
can use <code class="docutils literal notranslate"><span class="pre">lines_of_code_to_comments</span></code>.</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-TGludXg=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-0-TGludXg=" name="TGludXg=" role="tab" tabindex="0">Linux</button><button aria-controls="panel-0-TWFjT1M=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-0-TWFjT1M=" name="TWFjT1M=" role="tab" tabindex="-1">MacOS</button></div><div aria-labelledby="tab-0-TGludXg=" class="sphinx-tabs-panel group-tab" id="panel-0-TGludXg=" name="TGludXg=" role="tabpanel" tabindex="0"><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>curl -sSL <span class="s1">&#39;https://github.com/XAMPPRocky/tokei/releases/download/v10.1.1/tokei-v10.1.1-x86_64-unknown-linux-gnu.tar.gz&#39;</span> <span class="p">|</span> tar -xvz
<span class="go">tokei</span>
<span class="gp">$ </span><span class="nb">echo</span> <span class="s1">&#39;22699e16e71f07ff805805d26ee86ecb9b1052d7879350f7eb9ed87beb0e6b84fbb512963d01b75cec8e80532e4ea29a tokei&#39;</span> <span class="p">|</span> sha384sum -c -
<span class="go">tokei: OK</span>
<span class="gp">$ </span>sudo mv tokei /usr/bin/
</pre></div>
</div>
</div><div aria-labelledby="tab-0-TWFjT1M=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-0-TWFjT1M=" name="TWFjT1M=" role="tabpanel" tabindex="0"><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>curl -sSL <span class="s1">&#39;https://github.com/XAMPPRocky/tokei/releases/download/v10.1.1/tokei-v10.1.1-x86_64-apple-darwin.tar.gz&#39;</span> <span class="p">|</span> tar -xvz
<span class="go">tokei</span>
<span class="gp">$ </span><span class="nb">echo</span> <span class="s1">&#39;8c8a1d8d8dd4d8bef93dabf5d2f6e27023777f8553393e269765d7ece85e68837cba4374a2615d83f071dfae22ba40e2 tokei&#39;</span> <span class="p">|</span> sha384sum -c -
<span class="go">tokei: OK</span>
<span class="gp">$ </span>sudo mv tokei /usr/bin/
</pre></div>
</div>
</div></div>
<p>The <code class="docutils literal notranslate"><span class="pre">lines_of_code_to_comments</span></code> operation needs the output given by
<code class="docutils literal notranslate"><span class="pre">lines_of_code_by_language</span></code>, which needs a Git repos source code.</p>
<img alt="Diagram showing DataFlow of comment to code ratio operations" src="../_images/comments_to_code.svg" /><p>A <code class="docutils literal notranslate"><span class="pre">git_repository_checked_out</span></code> is defined as:</p>
<blockquote>
<div><ul class="simple">
<li><p>record: git_repository_checked_out(type: Dict[str, str])</p></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p>URL: str</p></li>
<li><p>directory: str</p></li>
<li><p>commit: str</p></li>
</ul>
</div></blockquote>
</div></blockquote>
<p><code class="docutils literal notranslate"><span class="pre">lines_of_code_by_language</span></code> just runs <code class="docutils literal notranslate"><span class="pre">tokei</span></code> on the <code class="docutils literal notranslate"><span class="pre">directory</span></code>, so if we
create <code class="docutils literal notranslate"><span class="pre">dict</span></code> (the programming language agnostic term is <code class="docutils literal notranslate"><span class="pre">mapping</span></code> /
<code class="docutils literal notranslate"><span class="pre">map</span></code>) with the property of <code class="docutils literal notranslate"><span class="pre">directory</span></code> pointing at the source code of the ,
Python package we downloaded for <code class="docutils literal notranslate"><span class="pre">bandit</span></code>, we’ll be able to use the Git
operations within the <code class="docutils literal notranslate"><span class="pre">shouldi</span></code> dataflow.</p>
<p>Let’s create the <code class="docutils literal notranslate"><span class="pre">override</span></code> directory which will contain the operations we
want to add to the <code class="docutils literal notranslate"><span class="pre">shouldi</span></code> dataflow, and how we want to connect those
operations with the existing ones.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">mkdir -p shouldi/deploy/override</span>
</pre></div>
</div>
<p>Use the <code class="docutils literal notranslate"><span class="pre">dataflow</span> <span class="pre">create</span></code> command to make a new dataflow that will be combined
with the existing flow.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>dffml dataflow create <span class="se">\</span>
<span class="go">    -configloader yaml \</span>
<span class="go">    -inputs \</span>
<span class="go">      directory=key \</span>
<span class="go">      safety_check.outputs.result,run_bandit.outputs.result,language_to_comment_ratio=get_single_spec \</span>
<span class="go">    -flow \</span>
<span class="go">      &#39;[{&quot;dffml.mapping.create&quot;: &quot;mapping&quot;}]=lines_of_code_by_language.inputs.repo&#39; \</span>
<span class="go">      &#39;[{&quot;pypi_package_contents&quot;: &quot;directory&quot;}]=&quot;dffml.mapping.create&quot;.inputs.value&#39; \</span>
<span class="go">    -- \</span>
<span class="go">      dffml.mapping.create \</span>
<span class="go">      lines_of_code_by_language \</span>
<span class="go">      lines_of_code_to_comments \</span>
<span class="go">    | tee shouldi/deploy/override/shouldi.yaml</span>
</pre></div>
</div>
<p>The final directory structure should look like this</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>tree shouldi/deploy
<span class="go">shouldi/deploy</span>
<span class="go">├── df</span>
<span class="go">│   └── shouldi.json</span>
<span class="go">├── mc</span>
<span class="go">│   └── http</span>
<span class="go">│       └── shouldi.yaml</span>
<span class="go">└── override</span>
<span class="go">    └── shouldi.yaml</span>

<span class="go">5 directories, 9 files</span>
</pre></div>
</div>
<p>It contains the following files.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">df/shouldi.json</span></code></p>
<ul>
<li><p>The <code class="docutils literal notranslate"><span class="pre">shouldi</span></code> dataflow</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">mc/http/shouldi.yaml</span></code></p>
<ul>
<li><p>A config file for the <code class="docutils literal notranslate"><span class="pre">http</span></code> multicomm, using the dataflow named <code class="docutils literal notranslate"><span class="pre">shouldi</span></code></p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">override/shouldi.yaml</span></code></p>
<ul>
<li><p>A dataflow containing modififactions to the <code class="docutils literal notranslate"><span class="pre">shouldi</span></code> dataflow</p></li>
</ul>
</li>
</ul>
<p>We’ve modified the flow to create the following dataflow</p>
<img alt="Diagram showing DataFlow with use of comment to code ratio" src="../_images/shouldi-dataflow-extended.svg" /><p>The diagram above can be re-generated with the following commands</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>dffml dataflow merge <span class="se">\</span>
<span class="go">    shouldi/deploy/df/shouldi.json \</span>
<span class="go">    shouldi/deploy/override/shouldi.yaml | \</span>
<span class="go">  dffml dataflow diagram \</span>
<span class="go">    -stages processing -simple -configloader json /dev/stdin</span>
</pre></div>
</div>
<p>Copy and pasting the graph into the
<a class="reference external" href="https://mermaidjs.github.io/mermaid-live-editor">mermaidjs live editor</a>
results in the graph.</p>
</div>
<div class="section" id="redeploying">
<h2>Redeploying<a class="headerlink" href="#redeploying" title="Permalink to this headline">¶</a></h2>
<p>We can now stop the server we had running, and start it again with the new
configs.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>dffml service http server -port <span class="m">8080</span> -insecure -mc-config shouldi/deploy
</pre></div>
</div>
<p>Here’s an example of evaluating two packages using the new DataFlow.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>curl -sf <span class="se">\</span>
<span class="go">  --header &quot;Content-Type: application/json&quot; \</span>
<span class="go">  --request POST \</span>
<span class="go">  --data &#39;{&quot;insecure-package&quot;: [{&quot;value&quot;:&quot;insecure-package&quot;,&quot;definition&quot;:&quot;safety_check.inputs.package&quot;}], &quot;dffml&quot;: [{&quot;value&quot;:&quot;dffml&quot;,&quot;definition&quot;:&quot;safety_check.inputs.package&quot;}]}&#39; \</span>
<span class="go">  http://localhost:8080/shouldi | python -m json.tool</span>
<span class="go">{</span>
<span class="go">    &quot;insecure-package&quot;: {</span>
<span class="go">        &quot;safety_check.outputs.result&quot;: 1,</span>
<span class="go">        &quot;run_bandit.outputs.result&quot;: {</span>
<span class="go">            &quot;CONFIDENCE.HIGH&quot;: 0.0,</span>
<span class="go">            &quot;CONFIDENCE.LOW&quot;: 0.0,</span>
<span class="go">            &quot;CONFIDENCE.MEDIUM&quot;: 0.0,</span>
<span class="go">            &quot;CONFIDENCE.UNDEFINED&quot;: 0.0,</span>
<span class="go">            &quot;SEVERITY.HIGH&quot;: 0.0,</span>
<span class="go">            &quot;SEVERITY.LOW&quot;: 0.0,</span>
<span class="go">            &quot;SEVERITY.MEDIUM&quot;: 0.0,</span>
<span class="go">            &quot;SEVERITY.UNDEFINED&quot;: 0.0,</span>
<span class="go">            &quot;loc&quot;: 100,</span>
<span class="go">            &quot;nosec&quot;: 0,</span>
<span class="go">            &quot;CONFIDENCE.HIGH_AND_SEVERITY.LOW&quot;: 0,</span>
<span class="go">            &quot;CONFIDENCE.HIGH_AND_SEVERITY.MEDIUM&quot;: 0,</span>
<span class="go">            &quot;CONFIDENCE.HIGH_AND_SEVERITY.HIGH&quot;: 0</span>
<span class="go">        },</span>
<span class="go">        &quot;language_to_comment_ratio&quot;: 19</span>
<span class="go">    },</span>
<span class="go">    &quot;dffml&quot;: {</span>
<span class="go">        &quot;safety_check.outputs.result&quot;: 0,</span>
<span class="go">        &quot;run_bandit.outputs.result&quot;: {</span>
<span class="go">            &quot;CONFIDENCE.HIGH&quot;: 24.0,</span>
<span class="go">            &quot;CONFIDENCE.LOW&quot;: 4.0,</span>
<span class="go">            &quot;CONFIDENCE.MEDIUM&quot;: 0.0,</span>
<span class="go">            &quot;CONFIDENCE.UNDEFINED&quot;: 0.0,</span>
<span class="go">            &quot;SEVERITY.HIGH&quot;: 1.0,</span>
<span class="go">            &quot;SEVERITY.LOW&quot;: 10.0,</span>
<span class="go">            &quot;SEVERITY.MEDIUM&quot;: 17.0,</span>
<span class="go">            &quot;SEVERITY.UNDEFINED&quot;: 0.0,</span>
<span class="go">            &quot;loc&quot;: 13289,</span>
<span class="go">            &quot;nosec&quot;: 0,</span>
<span class="go">            &quot;CONFIDENCE.HIGH_AND_SEVERITY.LOW&quot;: 10,</span>
<span class="go">            &quot;CONFIDENCE.HIGH_AND_SEVERITY.MEDIUM&quot;: 13,</span>
<span class="go">            &quot;CONFIDENCE.HIGH_AND_SEVERITY.HIGH&quot;: 1</span>
<span class="go">        },</span>
<span class="go">        &quot;language_to_comment_ratio&quot;: 6</span>
<span class="go">    }</span>
<span class="go">}</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="mnist.html" class="btn btn-neutral float-right" title="MNIST Handwriten Digits" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="shouldi.html" class="btn btn-neutral float-left" title="Meta Static Analysis" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2017 - 2021, Intel.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>